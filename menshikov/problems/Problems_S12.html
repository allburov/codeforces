<html>
<head>
 <title>Тренировка S12</title>
 <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
 <meta name="Author" content="Fyodor Menshikov, Vologda, Russia">
 <meta name="E-mail" content="mfv@mail.ru">
 <meta name="Homepage" content="http://www.uni-vologda.ac.ru/~mfv/">
</head>
<body bgcolor=white text=black>

<center><font size=+3>Тренировка S12</font></center><br>

<font size=-1>
Время тестирования приведено для Intel Celeron 400.<br>
Решения должны быть представлены на Turbo Pascal 7.0.
Объём памяти, предоставляемый программе, составляет 500 кб.
</font><br>

<a name="seq2">
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size=+1>
Задача A. Последовательность (2)</font><br><br>
Каждый член последовательности десятичных цифр <i>d</i><sub>1</sub>,
<i>d</i><sub>2</sub>, <i>d</i><sub>3</sub>...,  начиная с четвёртого,
равен последней цифре суммы трёх предыдущих. По заданным <i>d</i><sub>1</sub>,
<i>d</i><sub>2</sub>, <i>d</i><sub>3</sub> найти <i>N</i>-й член
последовательности.<br>
<b>Ограничения:</b> 1&nbsp;&lt;=&nbsp;<i>N</i>&nbsp;&lt;=&nbsp;10<sup>15</sup>,
время&nbsp;1&nbsp;с.<br>
<b>Ввод</b> из файла seq2.in. В первой строке находятся цифры
<i>d</i><sub>1</sub>, <i>d</i><sub>2</sub>, <i>d</i><sub>3</sub>, разделённые
пробелами, во второй - число <i>N</i>.<br>
<b>Вывод</b> в файл seq2.out. Вывести одну цифру -
<i>d<sub>N</sub></i>.<br>
<b>Примеры</b>
<pre><b>Ввод 1</b>    <b>Ввод 2</b>
1 4 8     5 5 5
4         1000000000000000
<b>Вывод 1</b>   <b>Вывод 2</b>
3         5
</pre>

<a name="garland">
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size=+1>
Задача B. Гирлянда</font><br><br>
<img src="garland.gif" align=right>
Гирлянда состоит из <i>N</i> лампочек на общем проводе. Один её конец закреплён
на заданной высоте <i>A</i> мм (<i>H</i><sub>1</sub>&nbsp;=&nbsp;<i>A</i>).
Благодаря силе тяжести гирлянда прогибается: высота каждой неконцевой лампы
на 1 мм меньше, чем средняя высота ближайших соседей
(<i>H<sub>i</sub></i>&nbsp;=&nbsp;(<i>H</i><sub><i>i</i>&nbsp;-&nbsp;1</sub>&nbsp;+&nbsp;<i>H</i><sub><i>i</i>&nbsp;+&nbsp;1</sub>)&nbsp;/&nbsp;2&nbsp;-&nbsp;1
для 1&nbsp;&lt;&nbsp;<i>i</i>&nbsp;&lt;&nbsp;<i>N</i>). Требуется найти
минимальную высоту второго конца <i>B</i>
(<i>B</i>&nbsp;=&nbsp;<i>H<sub>N</sub></i>) при условии, что ни одна из
лампочек не должна лежать на земле (<i>H<sub>i</sub></i>&nbsp;&gt;&nbsp;0 для
1&nbsp;&lt;=&nbsp;<i>i</i>&nbsp;&lt;=&nbsp;<i>N</i>).<br>
<b>Ограничения:</b> 3&nbsp;&lt;=&nbsp;<i>N</i>&nbsp;&lt;=&nbsp;1000 - целое,
10&nbsp;&lt;=&nbsp;<i>A</i>&nbsp;&lt;=&nbsp;1000 - вещественное,
время&nbsp;1&nbsp;с.<br>
<b>Ввод</b> из файла garland.in. В первой строке находятся два числа, <i>N</i>
и <i>A</i>.<br>
<b>Вывод</b> в файл garland.out. Вывести одно вещественное число <i>B</i>
с двумя знаками после запятой.<br>
<b>Примеры</b>
<pre><b>Ввод 1</b>    <b>Ввод 2</b>
8 15      692 532.81
<b>Вывод 1</b>   <b>Вывод 2</b>
9.75      446113.34
</pre>

<a name="mpuzzle">
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size=+1>
Задача C. Головоломка умножения</font><br><br>
В головоломку умножения играют с рядом карт, каждая из которых содержит одно
положительное целое число. Во время хода игрок убирает одну карту из ряда и
получает число очков, равное произведению числа на убранной карте и чисел на
картах, лежащих непосредственно слева и справа от неё. Не разрешено убирать
первую и последнюю карты ряда. После последнего хода в ряду остаётся только
две карты.
<br><br>
Цель игры - убрать карты в таком порядке, чтобы минимизировать общее количество
набранных очков.
<br><br>
Например, если карты содержат числа 10, 1, 50, 20 и 5, игрок
может взять карту с числом 1, затем 20 и 50, получая очки
<br><br>
10&nbsp;*&nbsp;1&nbsp;*&nbsp;50&nbsp;+&nbsp;50&nbsp;*&nbsp;20&nbsp;*&nbsp;5&nbsp;+&nbsp;10&nbsp;*&nbsp;50&nbsp;*&nbsp;5&nbsp;=&nbsp;500&nbsp;+&nbsp;5000&nbsp;+&nbsp;2500&nbsp;=&nbsp;8000.
<br><br>
Если бы он взял карты в обратном порядке, то&nbsp;есть 50, затем 20, затем 1,
количество очков было бы таким:
<br><br>
1&nbsp;*&nbsp;50&nbsp;*&nbsp;20&nbsp;+&nbsp;1&nbsp;*&nbsp;20&nbsp;*&nbsp;5&nbsp;+&nbsp;10&nbsp;*&nbsp;1&nbsp;*&nbsp;5&nbsp;=&nbsp;1000&nbsp;+&nbsp;100&nbsp;+&nbsp;50&nbsp;=&nbsp;1150.
<br><br>
<b>Ввод</b> из файла mpuzzle.in. В первой строке находится число карт <i>N</i>,
во второй - разделённые пробелами <i>N</i> чисел на картах.<br>
<b>Ограничения:</b> 3&nbsp;&lt;=&nbsp;<i>N</i>&nbsp;&lt;=&nbsp;100, числа
на картах целые от 1 до 100, время&nbsp;1&nbsp;с.<br>
<b>Вывод</b> в файл mpuzzle.out. Вывести одно целое число -
минимально возможное число очков.<br>
<b>Примеры</b>
<pre><b>Ввод 1</b>
6
10 1 50 50 20 5
<b>Вывод 1</b>
3650
</pre>

<a name="polygonp">
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size=+1>
Задача D. Точки в многоугольнике</font><br><br>
Многоугольник на плоскости задан целочисленными координатами своих <i>N</i>
вершин в декартовой системе координат. Требуется найти число точек с
целочисленными координатами, лежащих внутри многоугольника (не на границе).
Стороны многоугольника друг с другом не соприкасаются (за исключением соседних
- в вершинах) и не пересекаются.<br>
<b>Ограничения:</b> 3&nbsp;&lt;=&nbsp;<i>N</i>&nbsp;&lt;=&nbsp;10&nbsp;000,
координаты вершин целые и по модулю не превосходят 1&nbsp;000&nbsp;000,
время&nbsp;1&nbsp;с.<br>
<b>Ввод</b> из файла polygonp.in. В первой строке находится число <i>N</i>,
в следующих <i>N</i> строках - пары чисел - координаты точек. Если соединить
точки в данном порядке, а также соединить первую и последнюю точки, получится
заданный многоугольник.<br>
<b>Вывод</b> в файл polygonp.out. Вывести одно число - искомое количество
точек.<br>
<b>Примеры</b>
<pre><b>Ввод 1</b>
4
-10 -10
-10 10
10 10
10 -10
<b>Вывод 1</b>
361
</pre>

<a name="wpipe">
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size=+1>
Задача E. Водопровод</font><br><br>
<img src="wpipe.gif" align=right>
Город Восточный постоянно страдает от недостатка воды. Для устранения этой
проблемы была построена новая водопроводная труба. Строительство трубы началось
с обоих концов одновременно, и спустя некоторое время половины соединились.
Ну, почти. Первая половина трубы заканчивалась в точке
(<i>x</i><sub>1</sub>,&nbsp;<i>y</i><sub>1</sub>), а вторая - в точке
(<i>x</i><sub>2</sub>,&nbsp;<i>y</i><sub>2</sub>).
<br><br>
К сожалению, осталось лишь несколько отрезков трубы различной длины. Более
того, из-за специфики местной технологии трубы могут быть проложены только
в направлении с севера на юг или с востока на запад и соединяются, образуя
или прямую, или угол 90 градусов. Требуется, зная длины отрезков труб
<i>L</i><sub>1</sub>, <i>L</i><sub>2</sub>, ..., <i>L<sub>K</sub></i> и
количество отрезков каждой длины <i>C</i><sub>1</sub>, <i>C</i><sub>2</sub>,
..., <i>C<sub>K</sub></i>, сконструировать трубу, соединяющую две заданные
точки, или определить, что это невозможно.
<br><br>
<b>Ограничения:</b> 1&nbsp;&lt;=&nbsp;<i>K</i>&nbsp;&lt;=&nbsp;4,
1&nbsp;&lt;=&nbsp;<i>x</i><sub>1</sub>,&nbsp;<i>y</i><sub>1</sub>,&nbsp;<i>x</i><sub>2</sub>,&nbsp;<i>y</i><sub>2</sub>,&nbsp;<i>L<sub>i</sub></i>&nbsp;&lt;=&nbsp;1000,
1&nbsp;&lt;=&nbsp;<i>C<sub>i</sub></i>&nbsp;&lt;=&nbsp;10, все числа
целые, время&nbsp;3&nbsp;с.<br>
<b>Ввод</b> из файла wpipe.in. В первой строке находятся числа
<i>x</i><sub>1</sub>, <i>y</i><sub>1</sub>,
<i>x</i><sub>2</sub>, <i>y</i><sub>2</sub>, <i>K</i>,
затем 2<i>K</i> чисел: <i>L</i><sub>1</sub>, <i>L</i><sub>2</sub>, ...,
<i>L<sub>K</sub></i>, <i>C</i><sub>1</sub>, <i>C</i><sub>2</sub>, ...,
<i>C<sub>K</sub></i>.<br>
<b>Вывод</b> в файл wpipe.out. Вывести одно число - минимальное количество
нужных отрезков труб или -1, если соединение невозможно.<br>
<b>Примеры</b>
<pre><b>Ввод 1</b>              <b>Ввод 2</b>
5 5 5 6 1 2 10      20 10 60 50 2 70 30 2 2
<b>Вывод 1</b>             <b>Вывод 2</b>
-1                  4
</pre>

<a name="chem">
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font size=+1>
Задача F. Химические реакции</font><br><br>
Билл преподаёт химию в школе, он подготовил несколько тестов для учеников.
Каждый тест состоит из химической формулы и нескольких возможных результатов
реакции. Среди этих результатов ученики должны выбрать правильный. Билл хочет
убедиться в том, что, вводя свои тесты в компьютер, он не допустил опечаток,
благодаря которым ученики могли бы отбросить неверные ответы, просто подсчитав
число химических элементов в левой и правой частях уравнения (в правильном
уравнении химической реакции должно соблюдаться равенство).
<br><br>
Ваша задача - написать программу, которая поможет Биллу. Программа должна
прочитать описание теста, состоящее из заданной левой части уравнения и
нескольких возможных правых частей, и определить, равно ли количество
химических элементов в каждой предложенной правой части уравнения количеству
химических элементов в заданной левой части.
<br><br>
Билл формализовал задачу. И левая, и правая части уравнения представлены
строкой символов без пробелов, состоящей из одной или более химических
последовательностей, разделённых знаком плюс. Каждая последовательность имеет
необязательный предшествующий целый множитель, относящийся ко всей
последовательности, и несколько элементов. Каждый элемент может сопровождаться
необязательным целым множителем, относящимся к нему. Элемент в этом уравнении
может быть или отдельным химическим элементом, или целой последовательностью
в круглых скобках. Каждый отдельный химический элемент представлен или одной
прописной буквой, или прописной буквой, сопровождаемой строчной.
<br><br>
Ещё более формально, используя нотацию, аналогичную форме Бэкуса-Наура,
можно написать:
<ul>
<li><code>&lt;формула&gt; ::= [&lt;число&gt;] &lt;последовательность&gt;
{"+" [&lt;число&gt;] &lt;последовательность&gt;}</code>
<li><code>&lt;последовательность&gt; ::= &lt;элемент&gt; [&lt;число&gt;]
{&lt;элемент&gt; [&lt;число&gt;]}</code>
<li><code>&lt;элемент&gt; ::= &lt;химический&nbsp;элемент&gt; |
"(" &lt;последовательность&gt; ")"</code>
<li><code>&lt;химический&nbsp;элемент&gt; ::= &lt;прописная&nbsp;буква&gt;
[&lt;прописная&nbsp;буква&gt;]</code>
<li><code>&lt;заглавная&nbsp;буква&gt; ::= "A".."Z"</code>
<li><code>&lt;строчная&nbsp;буква&gt; ::= "a".."z"</code>
<li><code>&lt;число&gt; ::= "1".."9" {"0".."9"}</code>
</ul>
Будем говорить, что каждый отдельный химический элемент встречается в формуле
всего <i>X</i> раз, если <i>X</i> - сумма всех различных вхождений этого
химического элемента, умноженных на все числа, относящиеся к ним.
Например, в формуле <code>C2H5OH+3O2+3(SiO2)</code>
<ul>
<li><code>C</code> встречается всего 2 раза;
<li><code>H</code> встречается всего 6 раз (5&nbsp;+&nbsp;1);
<li><code>O</code> встречается всего 13 раз;
(1&nbsp;+&nbsp;3&nbsp;*&nbsp;2&nbsp;+&nbsp;3&nbsp;*&nbsp;2);
<li><code>Si</code> встречается всего 3 раза.
</ul>
Все множители в формулах - целые числа не меньше 2, если заданы явно, или равны
1 - по умолчанию.
<br><br>
<b>Ввод</b> из файла chem.in. В первой строке находится формула - левая часть
уравнения, во второй - одно число <i>N</i> - количество рассматриваемых правых
частей, в каждой из следующих <i>N</i> строк - одна формула - предлагаемая
правая часть уравнения.
<br><br>
<b>Ограничения:</b> 1&nbsp;&lt;=&nbsp;<i>N</i>&nbsp;&lt;=&nbsp;10, длина
формулы не превосходит 100 символов, каждый отдельный химический элемент
встречается всего не более 10&nbsp;000 раз в каждой формуле,
время&nbsp;1&nbsp;с.
<br><br>
<b>Вывод</b> в файл chem.out. Для каждой из <i>N</i> заданных правых частей
выведите одну строку вида
<pre>
&lt;формула левой части&gt;==&lt;формула правой части&gt;
</pre>
если общее количество вхождений каждого отдельного химического элемента в
левую часть равно общему числу вхождений этого химического элемента в правую
часть. В противном случае выведите:
<pre>
&lt;формула левой части&gt;!=&lt;формула правой части&gt;
</pre>
Здесь &lt;формула&nbsp;левой&nbsp;части&gt; должна быть замещена посимвольной
копией формулы левой части, как она дана в первой строке входного файла,
а &lt;формула&nbsp;правой&nbsp;части&gt; - замещена точной копией формулы
правой части, как она дана во входном файле. В строках не должно быть пробелов.
<br><br>
<b>Примеры</b>
<pre><b>Ввод 1</b>
C2H5OH+3O2+3(SiO2)
7
2CO2+3H2O+3SiO2
2C+6H+13O+3Si
99C2H5OH+3SiO2
3SiO4+C2H5OH
C2H5OH+3O2+3(SiO2)+Ge
3(Si(O)2)+2CO+3H2O+O2
2CO+3H2O+3O2+3Si
<b>Вывод 1</b>
C2H5OH+3O2+3(SiO2)==2CO2+3H2O+3SiO2
C2H5OH+3O2+3(SiO2)==2C+6H+13O+3Si
C2H5OH+3O2+3(SiO2)!=99C2H5OH+3SiO2
C2H5OH+3O2+3(SiO2)==3SiO4+C2H5OH
C2H5OH+3O2+3(SiO2)!=C2H5OH+3O2+3(SiO2)+Ge
C2H5OH+3O2+3(SiO2)==3(Si(O)2)+2CO+3H2O+O2
C2H5OH+3O2+3(SiO2)!=2CO+3H2O+3O2+3Si
</pre>
<u>Примечание.</u> Пример не содержит цифры ноль, потому что она выглядит
практически так же, как символ химического элемента кислорода. Настоящие
тесты могут содержать любые допустимые символы.

</body>
</html>
